

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setup Script &mdash; Grafana Provisioning  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Input Script" href="inputs.html" />
    <link rel="prev" title="Grafana API Module" href="grafanaAPI.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Grafana Provisioning
          

          
            
            <img src="_static/lsst-logo-dark.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Readme</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="readme.html">Server Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="readme.html#configuration">Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="readme.html#general-configuration">General Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#grafana-admin-accounts">Grafana Admin Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#default-organization">Default Organization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="readme.html#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#provisioning-setup">Provisioning Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#provisioning">Provisioning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#criteria-to-restart-grafana">Criteria to Restart Grafana</a></li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#faq">FAQ</a><ul>
<li class="toctree-l3"><a class="reference internal" href="readme.html#can-i-make-permanent-links-to-my-dashboards">Can I make permanent links to my dashboards?</a></li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#what-software-and-versions-does-this-project-use">What software and versions does this project use?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="readme.html#recommendations">Recommendations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="readme.html#grafana-settings">Grafana Settings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="readme.html#dns">DNS</a></li>
<li class="toctree-l4"><a class="reference internal" href="readme.html#viewers-can-edit">Viewers Can Edit</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#grafana-internal-database">Grafana Internal Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="readme.html#time-related-issues">Time Related Issues</a><ul>
<li class="toctree-l4"><a class="reference internal" href="readme.html#datasource-minimum-time-interval">Datasource Minimum Time Interval</a></li>
<li class="toctree-l4"><a class="reference internal" href="readme.html#influxdb-row-limit">InfluxDB Row Limit</a></li>
<li class="toctree-l4"><a class="reference internal" href="readme.html#telegraf-precision">Telegraf Precision</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="inputStructure.html">Provisioning Grafana Organizations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="inputStructure.html#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#grafana-basic-concepts">Grafana Basic Concepts</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#what-provisioning-your-organization-means">What Provisioning Your Organization Means</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inputStructure.html#input-structure">Input Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#organization">Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#accounts">Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#datasources">Datasources</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#folders-and-dashboards">Folders and Dashboards</a><ul>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#exporting-dashboards">Exporting Dashboards</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inputStructure.html#program-behavior-with-input-files">Program Behavior with Input Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#what-the-input-files-do">What the Input Files Do</a><ul>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#org-yaml">org.yaml</a></li>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#accounts-yaml">accounts.yaml</a></li>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#datasources-yaml">datasources.yaml</a></li>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#dashboards">dashboards/</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="inputStructure.html#what-the-input-files-can-t-do">What the Input Files Can’t Do</a><ul>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#id2">org.yaml</a></li>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#id3">accounts.yaml</a></li>
<li class="toctree-l4"><a class="reference internal" href="inputStructure.html#id4">dashboards/</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="yamlUtility.html">YAML Utility Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="yamlUtility.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="grafanaAPI.html">Grafana API Module</a><ul>
<li class="toctree-l2"><a class="reference internal" href="grafanaAPI.html#notes">Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="grafanaAPI.html#functions">Functions</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Scripts</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setup Script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#notes">Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="inputs.html">Input Script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="inputs.html#input-files">Input Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="inputs.html#organization">Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputs.html#accounts">Accounts</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputs.html#datasources">Datasources</a></li>
<li class="toctree-l3"><a class="reference internal" href="inputs.html#dashboards">Dashboards</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="inputs.html#notes">Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="inputs.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="accounts.html">Accounts Script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="accounts.html#functions">Functions</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Grafana Provisioning</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Setup Script</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/setup.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="inputs.html" class="btn btn-neutral float-right" title="Input Script" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="grafanaAPI.html" class="btn btn-neutral float-left" title="Grafana API Module" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-gpSetup">
<span id="setup-script"></span><h1>Setup Script<a class="headerlink" href="#module-gpSetup" title="Permalink to this headline">¶</a></h1>
<p>Configures Grafana Admin accounts and default org for a fresh installation.</p>
<p>This script is meant to run it’s main body only on a fresh installation of
Grafana. Still, it is designed to be able to be ran with every Puppet execution
with the help of the file <code class="docutils literal notranslate"><span class="pre">lastInitialization.txt</span></code> which will be stored in
the same directory where this is ran from. When this script completes
successfully, it will write the timestamp of when it initialized Grafana.</p>
<p>This script will load configurations stored in <code class="docutils literal notranslate"><span class="pre">admins/_kiosk.yaml</span></code> and 
<code class="docutils literal notranslate"><span class="pre">admins/_superAdmins.yaml</span></code>. It changes the <code class="docutils literal notranslate"><span class="pre">password</span></code> and account name
(<code class="docutils literal notranslate"><span class="pre">login</span></code>) for the default account (which has <code class="docutils literal notranslate"><span class="pre">super</span> <span class="pre">admin</span></code> privileges).
It will then create another account, which will be used by the script from now
on to make requests to Grafana’s API. With that account, the name of the
default organization will be changed.</p>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>Since Grafana’s API can be accessed over the network through the same port by
which the web client is accessed, it is <code class="docutils literal notranslate"><span class="pre">IMPORTANT</span></code> that this script is ran
before opening Grafana’s port (default is 3000) on the firewall.</p>
</div>
<div class="section" id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="gpSetup.changeAdminPassword">
<code class="descclassname">gpSetup.</code><code class="descname">changeAdminPassword</code><span class="sig-paren">(</span><em>newPasswd</em>, <em>user</em>, <em>password</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gpSetup.html#changeAdminPassword"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gpSetup.changeAdminPassword" title="Permalink to this definition">¶</a></dt>
<dd><p>Change Grafana Admin’s password.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>newPasswd</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last">New password for the Admin account</p>
</dd>
<dt><strong>user</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">login</span></code> of the Grafana account that is making the API request.</p>
</dd>
<dt><strong>password</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">password</span></code> of the Grafana account that is making the API request.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="grafanaAPI.html#module-grafanaAPI" title="grafanaAPI"><code class="xref py py-obj docutils literal notranslate"><span class="pre">grafanaAPI</span></code></a>, <a class="reference internal" href="#gpSetup.renameAdminUser" title="gpSetup.renameAdminUser"><code class="xref py py-obj docutils literal notranslate"><span class="pre">renameAdminUser</span></code></a></p>
</div>
<p class="rubric">Notes</p>
<p>It can be acceptable for the request to fail, if the execution of this script
was interrupted before and it is still necessary to complete the final steps.</p>
<p>When testing, changing the username and password did not kick the logged in 
user from the website.</p>
</dd></dl>

<dl class="function">
<dt id="gpSetup.renameAdminUser">
<code class="descclassname">gpSetup.</code><code class="descname">renameAdminUser</code><span class="sig-paren">(</span><em>data</em>, <em>user</em>, <em>password</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gpSetup.html#renameAdminUser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gpSetup.renameAdminUser" title="Permalink to this definition">¶</a></dt>
<dd><p>Change Grafana admin’s username.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>data: `dict`</strong></dt>
<dd><dl class="first last docutils">
<dt>Contains the fields accepted by Grafana API’s <code class="docutils literal notranslate"><span class="pre">User</span> <span class="pre">Update</span></code>:</dt>
<dd><ul class="first last simple">
<li>login: Change the username of the account (<cite>str</cite>).</li>
<li>name: Change the name of the account (<cite>str</cite>).</li>
<li>email: Change the email of the account (<cite>str</cite>).</li>
<li>theme: Change the theme of the account {<code class="docutils literal notranslate"><span class="pre">light</span></code>, <code class="docutils literal notranslate"><span class="pre">dark</span></code>}.</li>
</ul>
</dd>
</dl>
</dd>
<dt><strong>user</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">login</span></code> of the Grafana account that is making the API request.</p>
</dd>
<dt><strong>password</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">password</span></code> of the Grafana account that is making the API request.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="grafanaAPI.html#module-grafanaAPI" title="grafanaAPI"><code class="xref py py-obj docutils literal notranslate"><span class="pre">grafanaAPI</span></code></a>, <a class="reference internal" href="#gpSetup.changeAdminPassword" title="gpSetup.changeAdminPassword"><code class="xref py py-obj docutils literal notranslate"><span class="pre">changeAdminPassword</span></code></a></p>
</div>
<p class="rubric">Notes</p>
<p>It can be acceptable for the request to fail, if the execution of this script
was interrupted before and it is still necessary to complete the final steps.</p>
<p>When testing, changing the username and password did not kick the logged in 
user from the website.</p>
</dd></dl>

<dl class="function">
<dt id="gpSetup.renameKioskOrg">
<code class="descclassname">gpSetup.</code><code class="descname">renameKioskOrg</code><span class="sig-paren">(</span><em>user</em>, <em>password</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/gpSetup.html#renameKioskOrg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#gpSetup.renameKioskOrg" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename the default organization (id=1) to what is in <code class="docutils literal notranslate"><span class="pre">admins/_kiosk.yaml</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>user</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">login</span></code> of the Grafana account that is making the API request.</p>
</dd>
<dt><strong>password</strong> <span class="classifier-delimiter">:</span> <span class="classifier"><cite>str</cite></span></dt>
<dd><p class="first last"><code class="docutils literal notranslate"><span class="pre">password</span></code> of the Grafana account that is making the API request.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>FileNotFoundError</strong></dt>
<dd><p class="first last">Raised if <code class="docutils literal notranslate"><span class="pre">admins/_kiosk.yaml</span></code> can’t be found by this script. The file
must contain the name of the default organization and a list of users which
will be registered to it.</p>
</dd>
<dt><strong>ValueError</strong></dt>
<dd><p class="first last">Raised if 0 or more than 1 organizations exist in <code class="docutils literal notranslate"><span class="pre">admins/_kiosk.yaml</span></code>.
The number of organizations in this file must be exactly 1.</p>
</dd>
<dt><strong>grafanaAPI.APIError</strong></dt>
<dd><p class="first last">Raised if the request replies with a status code in the 4XX or 5XX range.
The causes include: The first organization does not exist, invalid 
credentials (<cite>user</cite> and <cite>password</cite>), the user doesn’t have permission to
make this request or the server is not responding. Check the error messages
for more information.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference internal" href="grafanaAPI.html#grafanaAPI.request" title="grafanaAPI.request"><code class="xref py py-obj docutils literal notranslate"><span class="pre">grafanaAPI.request</span></code></a></p>
</div>
<p class="rubric">Notes</p>
<p>Affects the current context organization for the user.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="inputs.html" class="btn btn-neutral float-right" title="Input Script" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="grafanaAPI.html" class="btn btn-neutral float-left" title="Grafana API Module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019 Association of Universities for Research in Astronomy.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
<p><br>
    This project was developed for the IT Department of the LSST Project and
    AURA by the intern José Moreno Hanshing under the supervision of Andrés
    Villalobos Rivera, during Jan-Feb 2019 in the city of La Serena.
    <address>
        Contact: <a href="mailto:webmaster@example.com">
        jmoreno.hanshing@gmail.com</a>
    </address>
</p>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>